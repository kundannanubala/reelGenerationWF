# AI-Powered Children's Story Generator Documentation

This documentation provides an in-depth explanation of the codebase, demonstrating not only the technical details but also the overall design philosophy behind the AI-Powered Children's Story Generator. Enjoy building and expanding this innovative solution!

---

## Table of Contents

- [Overview](#overview)
- [Key Features](#key-features)
- [System Architecture & Workflow](#system-architecture--workflow)
- [Technology Stack](#technology-stack)
- [Installation & Configuration](#installation--configuration)
- [Project Structure & Detailed Code Walkthrough](#project-structure--detailed-code-walkthrough)
  - [Main Application (app.py)](#main-application-apppy)
  - [Interactive Web Interface (streamlit_app.py)](#interactive-web-interface-streamlit_apppy)
  - [Services](#services)
    - [Story Generation & Flashcard Service (`services/storyGenerationService.py`)](#story-generation--flashcard-service-servicesstorygenerationservicepy)
    - [Text-to-Speech Service (`services/textToSpeechService.py`)](#text-to-speech-service-servicestexttospeechservicepy)
    - [Text-to-Image Service (`services/textToImageService.py`)](#text-to-image-service-servicestexttoimageservicepy)
    - [Video Generation Service (`services/videoGenerationService.py`)](#video-generation-service-servicesvideogenerationservicepy)
  - [Configuration (core/config.py)](#configuration-coreconfigpy)
- [Workflow Explanation](#workflow-explanation)
- [Additional Files & Directories](#additional-files--directories)
- [Future Enhancements](#future-enhancements)
- [Contributing & Support](#contributing--support)

---

## Overview

The AI-Powered Children's Story Generator is an automated end-to-end creative solution. It takes a brief text prompt as input and produces a complete multimedia storytelling experience. This includes:

- **Story Text Generation:** Generates a concise, 100-word children's story.
- **Scene Flashcards:** Breaks down the story into visually-oriented flashcards.
- **Audio Narration:** Converts the story text into narrated audio using Google Text-to-Speech.
- **Image Generation:** Creates appealing images for each scene using Vertex AI.
- **Video Assembly:** Compiles the images and audio into a video that showcases the full story.

This solution streamlines the content creation process and is ideal for educators, storytellers, and digital media professionals.

---

## Key Features

- **Automated Creative Content Generation:** Quickly produce story narratives and visual components.
- **Multimedia Output:** Combine text, audio, images, and video in one seamless workflow.
- **Cloud-Based AI Integration:** Leverage Google Cloud's Vertex AI and Text-to-Speech services.
- **Interactive UI:** Use the Streamlit web interface for an enhanced user experience.
- **Secure & Configurable Setup:** Uses environment variables and `.env` files to securely manage credentials.

---

## System Architecture & Workflow

1. **Initialization and Input Handling:**
   - The system starts by loading the necessary configurations and credentials.
   - The user provides a text prompt which forms the basis of the story.

2. **Story and Flashcard Generation:**
   - The application uses a generative AI model (Google's Gemini 1.5 Pro) to create a concise story.
   - A corresponding flashcard is generated that separates the story into scene descriptions.

3. **Audio Narration:**
   - The generated story is processed by the Text-to-Speech service, converting it into an MP3 audio file.
  
4. **Image Generation:**
   - The flashcard is analyzed to extract distinct scene descriptions.
   - For each scene, an image is produced using a Vertex AI-powered image generation model.

5. **Video Compilation:**
   - The images and audio narration are compiled together using MoviePy.
   - The video is generated by synchronizing image display durations with the narration.

6. **Output and Presentation:**
   - Depending on how the application is invoked, the results will be delivered via a command-line interface or an interactive Streamlit web interface.

---

## Technology Stack

- **Programming Language:** Python 3.x
- **Google Cloud Services:**
  - Vertex AI for text and image generation.
  - Google Cloud Text-to-Speech for audio narration.
- **Libraries & Frameworks:**
  - **LangChain:** Orchestrates dynamic prompt chains.
  - **MoviePy:** Compiles multimedia outputs into video.
  - **Streamlit:** Provides an interactive web-based user interface.
  - **pydantic-settings:** Manages application configuration securely.

---

## Installation & Configuration

1. **Clone the Repository:**

   ```bash
   git clone https://github.com/kundannanubala/reelGenerationWF.git
   cd reelGenerationWF
   ```

2. **Set Up the Virtual Environment:**

   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. **Install Dependencies:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Configure Environment Variables:**

   Create a `.env` file in the root directory with:

   ```plaintext
   GOOGLE_APPLICATION_CREDENTIALS=path/to/credentials.json
   GOOGLE_APPLICATION_CREDENTIALS2=path/to/credentials2.json
   GOOGLE_CLOUD_PROJECT=your-project-id
   GOOGLE_CLOUD_REGION=your-region
   GOOGLE_CLOUD_REGION2=your-region-2
   ```

5. **Run the Application:**

   - **Command-Line Interface:**

     ```bash
     python app.py
     ```

   - **Interactive Streamlit Interface:**

     ```bash
     streamlit run streamlit_app.py
     ```

---

## Project Structure & Detailed Code Walkthrough

### Main Application (`app.py`)

- **Purpose:**  
  Serves as the central orchestrator for generating stories, audio narration, images, and compiling the video.
  
- **Workflow Steps:**  
  - Initializes configuration and credentials.
  - Calls `generate_story` to produce a written narrative.
  - Uses `flashcard_generator` to split the story into flashcards.
  - Invokes `text_to_speech` to convert text into audio.
  - Processes flashcards with `extract_and_generate_scenes` for image creation.
  - Uses MoviePy (via `create_video_from_images_and_audio`) for video assembly.

### Interactive Web Interface (`streamlit_app.py`)

- **Purpose:**  
  Provides a friendly web UI for users to input prompts and observe real-time generation of multimedia content.
  
- **Highlights:**  
  - Displays progress spinners during processing.
  - Shows the generated story text, flashcard scenes, audio, and images.
  - Offers an intuitive column layout for image display.

### Services

#### Story Generation & Flashcard Service (`services/storyGenerationService.py`)

- **Core Functions:**
  - **`generate_story(story_context)`:**  
    Uses a generative AI model to create a concise, child-friendly narrative based on a given prompt.
  - **`flashcard_generator(story)`:**  
    Processes the generated story to produce scene-based flashcards using LangChain and the Gemini 1.5 Pro model with a specific template.

#### Text-to-Speech Service (`services/textToSpeechService.py`)

- **Core Functions:**
  - **`text_to_speech(story)`:**  
    Converts the textual story into an MP3 audio file.  
  - **Implementation Details:**  
    - Utilizes the Google Cloud Text-to-Speech API.
    - Configures voice parameters, such as language, voice gender, pitch, and speaking rate.
    - Saves output audio to a designated directory.

#### Text-to-Image Service (`services/textToImageService.py`)

- **Core Functions:**
  - **`extract_and_generate_scenes(flashcard, story)`:**  
    Parses the flashcard text to isolate individual scene descriptions.
  - **Implementation Details:**  
    - Applies regular expressions to determine scene boundaries.
    - Invokes Vertex AI's image generation model to produce images that align with the narrative's tone and style.
    - Stores images in the `generated_blog_images` folder.

#### Video Generation Service (`services/videoGenerationService.py`)

- **Core Functions:**
  - **`create_video_from_images_and_audio(image_paths, audio_path)`:**  
    Combines images and narration into a synchronized video output.
  - **Additional Functionality:**  
    - **`extract_scene_durations(flashcard)`:**  
      Analyzes the length of each scene's narration to calculate appropriate display durations based on word count.
    - **Implementation Details:**  
      - Uses MoviePy to generate individual image clips.
      - Concatenates the clips while syncing the background audio.

### Configuration (`core/config.py`)

- **Purpose:**  
  Centralizes application configuration and securely loads sensitive credentials using `pydantic-settings`.
- **Key Configuration Variables:**  
  - `GOOGLE_APPLICATION_CREDENTIALS`, `GOOGLE_APPLICATION_CREDENTIALS2`
  - `GOOGLE_CLOUD_PROJECT`, `GOOGLE_CLOUD_REGION`, `GOOGLE_CLOUD_REGION2`
- **Usage:**  
  Access these settings throughout the codebase to ensure a consistent configuration approach.

---

## Workflow Explanation

1. **Initialization:**  
   - Configuration settings are loaded from the `.env` file.
   - Google Cloud credentials are established using the `core/config.py` module.
   
2. **Story Creation:**  
   - The user provides a short story prompt.
   - The generated story and corresponding flashcards are produced using the Gemini AI model.

3. **Multimedia Generation:**  
   - The text-to-speech service converts the story into an audio narration (MP3 format).
   - The flashcards are parsed and processed to generate corresponding images for each scene using Vertex AI.

4. **Video Assembly:**  
   - Image clips are generated and synchronized with the narration audio.
   - The final video is compiled with MoviePy, resulting in a cohesive multimedia presentation.

5. **Output Delivery:**  
   - The application either prints outputs to the terminal or displays them interactively via the Streamlit UI.

---

## Additional Files & Directories

- **`.env`**  
  Contains all sensitive API keys and configuration variables. _(Do not commit this file to version control!)_

- **`.gitignore` & `.gitattributes`**  
  Ensure that credentials, virtual environments, and other non-essential files are excluded from version control.

- **IDE Files (e.g., `.idea/workspace.xml`)**  
  Configuration files specific to your development environment.

- **`requirements.txt`**  
  Lists all dependencies necessary for the project including Google Cloud SDKs, LangChain libraries, MoviePy, and Streamlit.

---

## Future Enhancements

- **Enhanced Error Handling & Logging:**  
  Implement more robust logging and exception management for stability under heavy use.
  
- **User Customization:**  
  Allow users to select different voices, image styles, and video effects.
  
- **Scalability Improvements:**  
  Optimize the pipeline to handle concurrent and bulk processing requests.
  
- **UI/UX Upgrades:**  
  Develop a more dynamic and engaging user interface with real-time status updates and better design ergonomics.

---

## Contributing & Support

Contributions are welcome! If you'd like to contribute:

1. Fork the repository.
2. Create a new branch for your feature or bugfix.
3. Make your changes with well-documented commit messages.
4. Submit a pull request with a detailed description of your changes.

For questions or support, please reach out at [kundannaubala@gmail.com](mailto:kundannaubala@gmail.com).

---

Enjoy exploring and expanding the AI-Powered Children's Story Generator! 